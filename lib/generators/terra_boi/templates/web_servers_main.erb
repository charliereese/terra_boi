# ---------------------------------------------------------------------------------------------------------------------
# 1. STATE
# ---------------------------------------------------------------------------------------------------------------------

terraform {
  backend "s3" {
    bucket         = "<%= application_name %>-terraform-state-storage"
    key            = "terraform/<%= config[:env] %>-state/web-servers"
    region         = "us-east-2"
    dynamodb_table = "<%= application_name %>-terraform-state-lock"
    encrypt        = true
  }
}

# ---------------------------------------------------------------------------------------------------------------------
# 2. WEB SERVERS MODULE
# ---------------------------------------------------------------------------------------------------------------------

module "webserver_cluster" {
  source = "github.com/charliereese/terraform_modules//web_servers?ref=v0.0.14"

  instance_type       	= "t2.micro"
  env                 	= "<%= config[:env] %>"
  app_name            	= "<%= application_name %>"
  domain_name         	= "<%= config[:domain_name] %>"
  id_rsa_pub						= "<%= id_rsa_pub %>"
  min_size            	= 1
  max_size            	= 1
  business_hours_size 	= 1
  night_hours_size    	= 1
}