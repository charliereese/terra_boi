# -------------------------------------------------------------------
# 1. STATE
# -------------------------------------------------------------------

terraform {
  backend "s3" {
    bucket         = "<%= application_name %>-terraform-state-storage"
    key            = "terraform/<%= config[:env] %>-state/master-worker"
    region         = "us-east-2"
    dynamodb_table = "<%= application_name %>-terraform-state-lock"
    encrypt        = true
  }
}

# -------------------------------------------------------------------
# 2. MASTER WORKER MODULE
# -------------------------------------------------------------------

module "master_worker_cluster" {
  source = "github.com/charliereese/terraform_modules//master_worker?ref=v0.0.23"

  instance_type       	= "t2.micro"
  env                 	= "<%= config[:env] %>"
  app_name            	= "<%= application_name %>"
  id_rsa_pub						= "<%= id_rsa_pub %>"
}